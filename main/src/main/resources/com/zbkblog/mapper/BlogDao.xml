<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zbkblog.dao.BlogDao">
    <!--BlogDoc对应的映射-->
    <resultMap id="ResultBlogDoc" type="com.zbkblog.medo.BlogDoc" >
        <id column="blogId" property="blogId" jdbcType="INTEGER" />
        <result column="blogTitle" property="blogTitle" jdbcType="VARCHAR" />
        <result column="blogClassId" property="blogClassId" jdbcType="INTEGER" />
        <result column="blogClassName" property="blogClassName" jdbcType="VARCHAR" />
        <result column="blogTagId" property="blogTagId" jdbcType="INTEGER" />
        <result column="blogTagName" property="blogTagName" jdbcType="VARCHAR" />
        <result column="blogMd" property="blogMd" jdbcType="VARCHAR" />
        <result column="updataTime" property="updataTime" jdbcType="INTEGER" />
        <result column="updataTimeStr" property="updataTimeStr" jdbcType="VARCHAR" />
        <result column="openNumber" property="openNumber" jdbcType="INTEGER" />
        <result column="supportNumber" property="supportNumber" jdbcType="INTEGER" />
    </resultMap>

    <select id="findClass" resultType="ResultBlogDoc">
        SELECT blogClassId,blogClassName FROM blogclass
    </select>
    <select id="findTag" resultType="ResultBlogDoc">
        SELECT blogTagId,blogTagName FROM blogtag
    </select>

    <!-- 组合查询(where标签用在SQL中的where条件判断处) -->
    <select id="findBlogDoc" resultType="com.zbkblog.medo.BlogDoc">
        <!-- parameterType="blogDoc" parameterMap=""-->
        select * from blogdoc
        <where>
            <if test="blogId!=null">
                blogId=#{blogId}
            </if>
            <if test="blogTitle!=null">
                and blogTitle=#{blogTitle}
            </if>
            <if test="blogClass!=null">
                and blogClass=#{blogClass}
            </if>
            <if test="blogTag!=null">
                and blogTag LIKE '%'#{blogTag}'%'
            </if>
        </where>
    </select>

    <!-- 分页查询 -->
    <select id="findAllBlogDocPaging" parameterType="com.zbkblog.medo.BlogDoc" resultMap="ResultBlogDoc">
        SELECT bd.blogId AS blogId,bd.blogTitle AS blogTitle,bd.blogClassId AS blogClassId,
        bc.blogClassName AS blogClassName,bd.blogTagId AS blogTagId,bt.blogTagName AS blogTagName,
        bd.blogMd AS blogMd,bd.updataTime AS updataTime,bd.updataTimeStr AS updataTimeStr,
        bd.openNumber AS openNumber,bd.supportNumber AS supportNumber
        FROM blogdoc AS bd LEFT JOIN blogclass AS bc ON bd.blogClassId=bc.blogClassId
        LEFT JOIN blogtag AS bt ON bd.blogTagId=bt.blogTagId
        WHERE 1 = 1
        <if test="blogClassId!=null">
            AND blogClassId=#{blogClassId}
        </if>
        <if test="blogTagId!=null">
            AND blogTagId=#{blogTagId}
        </if>
        ORDER BY updataTime
    </select>

    <insert id="save" parameterType="com.zbkblog.medo.BlogDoc">
        begin
        insert into blogclass
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="blogClassId != null" >
                blogClassId,
            </if>
            <if test="blogClassName != null" >
                blogClassName,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="blogClassId != null" >
                #{blogClassId,jdbcType=INTEGER},
            </if>
            <if test="blogClassName != null" >
                #{blogClassName,jdbcType=VARCHAR},
            </if>
        </trim>;

        insert into blogtag
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="blogTagId != null" >
                blogTagId,
            </if>
            <if test="blogTagName != null" >
                blogTagName,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="blogTagId != null" >
                #{blogTagId,jdbcType=INTEGER},
            </if>
            <if test="blogTagName != null" >
                #{blogTagName,jdbcType=VARCHAR},
            </if>
        </trim>;

        insert into blogdoc
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="blogId != null" >
                blogId,
            </if>
            <if test="blogTitle != null" >
                blogTitle,
            </if>
            <if test="blogClassId != null" >
                blogClassId,
            </if>
            <if test="blogTagId != null" >
                blogTagId,
            </if>
            <if test="blogMd != null" >
                blogMd,
            </if>
            <if test="updataTime != null" >
                updataTime,
            </if>
            <if test="updataTimeStr != null" >
                updataTimeStr,
            </if>
            <if test="openNumber != null" >
                openNumber,
            </if>
            <if test="supportNumber != null" >
                supportNumber,
            </if>
            ;
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="orderId != null" >
                #{orderId,jdbcType=VARCHAR},
            </if>

            <if test="blogId != null" >
                #{blogId,jdbcType=VARCHAR},
            </if>
            <if test="blogTitle != null" >
                #{blogId,jdbcType=VARCHAR},
                blogTitle,
            </if>
            <if test="blogClassId != null" >
                blogClassId,
            </if>
            <if test="blogTagId != null" >
                blogTagId,
            </if>
            <if test="blogMd != null" >
                blogMd,
            </if>
            <if test="updataTime != null" >
                updataTime,
            </if>
            <if test="updataTimeStr != null" >
                updataTimeStr,
            </if>
            <if test="openNumber != null" >
                openNumber,
            </if>
            <if test="supportNumber != null" >
                supportNumber,
            </if>

        </trim>;
        end;
    </insert>

    <select id="findBlogDocByBlogId" resultType="com.zbkblog.medo.BlogDoc">
        <!-- parameterType="blogDoc" parameterMap=""-->
        select * from blogdoc where blogId=#{blogId}
    </select>

    <!--<insert id="save">-->
        <!--insert into blogdoc (blogId,blogTitle,blogClass,blogTag,blogMd,updataTime,updataTimeStr)-->
        <!--values (#{blogId},#{blogTitle},#{blogClass},#{blogTag},#{blogMd},#{updataTime},#{updataTimeStr})-->
    <!--</insert>-->

    <update id="updata">
        update blogdoc set
        blogTitle = #{blogTitle},
        blogClass = #{blogClass},
        blogTag = #{blogTag},
        blogMd = #{blogMd},
        updataTime = #{updataTime},
        updataTimeStr = #{updataTimeStr}
        where blogId = #{blogId}
    </update>

    <!-- 组合查询(where标签用在SQL中的where条件判断处) -->
    <!--<select id="findEmps" parameterType="map"-->
            <!--resultType="com.xdl.entity.Emp">-->
        <!--&lt;!&ndash; 可以定义一个map传进来，然后下面使用map的key来取得value &ndash;&gt;-->
        <!--select * from emp-->
        <!--<where>-->
            <!--<if test="name!=null">&lt;!&ndash; name是map中的key &ndash;&gt;-->
                <!--ename like #{name} &lt;!&ndash; name是map中的key &ndash;&gt;&lt;!&ndash; 如：%a%，查询带a的 &ndash;&gt;-->
            <!--</if>-->
            <!--<if test="hire!=null">-->
                <!--and hiredate=#{hire}-->
                <!--&lt;!&ndash; 使用java.sql.Data.valueOf("1981-01-11") 把一个字符串转成日期类型穿进map &ndash;&gt;-->
            <!--</if>-->
            <!--<if test="dept!=null">-->
                <!--or deptno=#{dept}-->
            <!--</if>-->
        <!--</where>-->
    <!--</select>-->
            <!--&lt;!&ndash; 动态更新 ：传入参数的属性值为null就不参与update&ndash;&gt;-->
    <!--<update id="updateEmp" parameterType="com.xdl.entity.Emp">-->
    <!--update emp-->
    <!--<set>-->
        <!--<if test="ename!=null">-->
            <!--ename=#{ename},-->
        <!--</if>-->
        <!--<if test="hiredate!=null">-->
            <!--hiredate=#{hiredate},-->
        <!--</if>-->
        <!--<choose>-->
            <!--<when test="sal!=null">sal=#{sal},</when>-->
            <!--<otherwise>sal=1800</otherwise>-->
        <!--</choose>-->
        <!--<if test="comm!=null">-->
            <!--comm=#{comm},-->
        <!--</if>-->
        <!--<if test="deptno!=null">-->
            <!--deptno=#{deptno}-->
        <!--</if>-->
    <!--</set>-->
    <!--where empno=#{empno}-->
    <!--</update>-->
</mapper>