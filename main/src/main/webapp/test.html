<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="static/jqueryui/jquery-ui.css" />
</head>
<body>
<span class="caption">国籍：</span>
<input type="text" class="btn w260" autocomplete="off" placeholder="按拼音首字母搜索" id="nationality" name="nationality">

<script src="static/js/jquery-3.2.0.js"></script>
<script src="static/jqueryui/jquery-ui.js"></script>
<script src="static/spell/py.js"></script><!--汉字转拼音的js -->
<script>

    /**
     * 给数据添加拼音
     *
     * 传入两个参数，
     *  data：一个json数组
     *  label：中文所在元素的key
     *
     * 返回
     *  在原json数组的每个元素中添加两个字段
     *      spell：大写的首字母
     *      fullSpelling：大写的全拼
     *
     */
    function addSpell(data,label) {
        $.each(data,function (n,value) {
            value['spell']=pinyin.getCamelChars(value[label]);
            value['fullSpelling']=pinyin.getFullChars(value[label]).toUpperCase();
        });
        return data;
    }
    /*
     自动完成国籍搜索
      */
    //用来根据输入筛选结果集
    function serchNationality(callBack,key,label) {
        function isBigEnough(element, index, array) {
            var re = new RegExp(key);
            //返回true则保留轮询到的数组元素，返回false则不保留
            if (re.test(array[index]['spell'])){return true;}
            if (re.test(array[index]['fullSpelling'])){return true;}
            if (array[index][label] && re.test(array[index][label])){return true;}
            return false;
        }
        callBack(MyData['cache'].filter(isBigEnough));//使用数组的filter来过滤
    }
    //搜索国籍的主要方法
    function autoCompleteNationality(domId) {
        if (MyData['cache'] == undefined){//如果国籍缓存没有初始化就初始化一下
            MyData['cache'] = addSpell(MyData['NATIONALITY'],"label"); //将数据添加拼音信息后保存到变量
        }
        $(domId).autocomplete({
            minLength:0,
            //用source加载列表数据
            source: function (request, response) {
                var key = request.term.trim().toUpperCase();
                if (typeof(key) == "undefined" || key == "" || key == null){ //如果什么都没有输入，则加载列表的全部
                    response(MyData['cache'])
                    return;
                }
                //否则调用过滤方法加载过滤后的数据
                serchNationality(function (data) {
                    response(data);
                },key,'label');
            },
            create: function () { //创建的下拉列表
                $(this).data('ui-autocomplete')._renderItem = function (ul, item) {
                    return $("<li>")
                        .append($("<div>")).text(item.label)
                        .appendTo(ul); //return的就是列表的HTML
                };
            },
            select: function (event, ui) { //选择一个选项后的操作
                var item = ui.item;
                $(this).val(ui.item.value);
                for (var i in item) {
                    $(this).attr(i, item[i]);
                }
                event.preventDefault(); //阻止元素的默认行为
                $(this).blur(); //让当前元素失去焦点
            }
        }).focus(function (){
            $(this).autocomplete("search");
        });
    }
    //数据源
    var MyData = {
        NATIONALITY:
            [{label:"中国"}, {label:"美国"}, {label:"英国"}, {label:"法国"}, {label:"德国"},
            {label:"俄罗斯"}, {label:"澳大利亚"}, {label:"意大利"}, {label:"希腊"}, {label:"埃及"},
            {label:"日本"}, {label:"韩国"}, {label:"朝鲜"}, {label:"印度"}, {label:"老挝"},
            {label:"柬埔寨"}, {label:"缅甸"}, {label:"泰国"}]
    };
    //自动完成国籍搜索
    autoCompleteNationality('#nationality');
</script>
</body>
</html>